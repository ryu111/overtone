# V1 é©—è­‰å ±å‘Š
> æ—¥æœŸï¼š2026-02-26 | é©—è­‰è€…ï¼šqa agent

---

## é©—è­‰æ‘˜è¦

| åŠŸèƒ½ | é©—è­‰ç‹€æ…‹ | é©—è­‰æ–¹å¼ | å‚™è¨» |
|------|---------|---------|------|
| F1 Dashboard History Tabï¼ˆpassAtK çµ±è¨ˆï¼‰ | âœ… é€šé | è‡ªå‹• + æ•´åˆ | passAtK å‡½æ•¸æ­£ç¢ºï¼ŒAPI ç«¯é»æ­£å¸¸ |
| F2 Model Graderï¼ˆHaiku ä¸‰ç¶­è©•åˆ†ï¼‰ | âš ï¸ å¾…ç¢ºèª | æ‰‹å‹• | agent prompt å­˜åœ¨ï¼Œéœ€çœŸå¯¦åŸ·è¡Œç’°å¢ƒé©—è­‰ |
| F3 `[workflow:xxx]` è¦†å¯«èªæ³• | âš ï¸ éƒ¨åˆ†é€šé | è‡ªå‹• | æ ¸å¿ƒè§£ææ­£ç¢ºï¼Œä½† `/ot:` passthrough è¼¸å‡ºèˆ‡è¦æ ¼ä¸ç¬¦ |
| F4 Dashboard å‹•ç•«ç‰ˆï¼ˆCSS å‹•ç•«ï¼‰ | âš ï¸ å¾…ç¢ºèª | æ‰‹å‹• | CSS å®šç¾©å®Œæ•´ï¼ˆ7 keyframesï¼‰ï¼Œéœ€ç€è¦½å™¨è¦–è¦ºç¢ºèª |
| F5 Loop æ©Ÿåˆ¶ï¼ˆStop hookï¼‰ | âœ… é€šé | è‡ªå‹• + æ•´åˆ | block æŒ‡ä»¤æ­£ç¢ºï¼Œå®Œæˆæ‘˜è¦æ­£ç¢º |
| F6 SubagentStop è¨˜éŒ„ | âœ… é€šé | è‡ªå‹• | parse-result 17 passï¼Œã€Œå§”æ´¾ plannerã€æç¤ºå­˜åœ¨ |
| F7 UserPromptSubmit â†’ /ot:auto æ³¨å…¥ | âš ï¸ éƒ¨åˆ†é€šé | è‡ªå‹• + æ•´åˆ | ä¸»è¦æµç¨‹æ­£ç¢ºï¼Œä½† `/ot:` passthrough è¼¸å‡ºæ ¼å¼èˆ‡è¦æ ¼ä¸ç¬¦ |
| F8 timeline.jsonl äº‹ä»¶è¨˜éŒ„ | âœ… é€šé | è‡ªå‹• + æ•´åˆ | emit/query/latest/passAtK å…¨éƒ¨è¡Œç‚ºæ­£ç¢º |
| F9 workflow.json CAS åŸå­æ›´æ–° | âœ… é€šé | è‡ªå‹• | 12 passï¼Œç„¡æ®˜é¤˜ tmp æª” |

---

## è‡ªå‹•åŒ–é©—è­‰çµæœ

### bun test å…¨å¥—

```
165 pass
0 fail
381 expect() calls
Ran 165 tests across 10 files. [742ms]
```

æ¶µè“‹ç¯„åœï¼š
- `tests/timeline.test.js` â€” passAtK è¨ˆç®—é‚è¼¯ï¼ˆ8 å€‹æ¸¬è©¦ï¼‰
- `tests/loop.test.js` â€” Loop ç‹€æ…‹ç®¡ç†ï¼ˆ8 å€‹æ¸¬è©¦ï¼‰
- `tests/parse-result.test.js` â€” SubagentStop verdict è§£æï¼ˆ17 å€‹æ¸¬è©¦ï¼‰
- `tests/state.test.js` â€” workflow.json CAS åŸå­æ›´æ–°ï¼ˆ12 å€‹æ¸¬è©¦ï¼‰
- å…¶ä»– 6 å€‹æ¸¬è©¦æª”ï¼ˆå…± 120 å€‹æ¸¬è©¦ï¼‰

### F1 â€” passAtK å‡½æ•¸èˆ‡ API ç«¯é»

- `passAtK()` å‡½æ•¸å­˜åœ¨æ–¼ `timeline.js`ï¼Œå›å‚³çµæ§‹åŒ…å« `sessionId`ã€`computed`ã€`stages`ã€`overall` å››å€‹æ¬„ä½
- ç©º session æ™‚ `overall.stageCount = 0`ï¼Œ`overall.pass1Rate = null`ï¼ˆæ­£ç¢ºçš„ graceful fallbackï¼‰
- `GET /api/sessions/:id/passatk` ç«¯é»æ­£ç¢ºå›å‚³ passAtK çµæœï¼Œä¸å­˜åœ¨ session å›å‚³ `{"error":"Session ä¸å­˜åœ¨"}` 404

### F3 â€” `[workflow:xxx]` è§£æé‚è¼¯

- åˆæ³• keyï¼ˆ`[workflow:standard]`ï¼‰ï¼šæ­£ç¢ºè§£æï¼ŒadditionalContext å«ã€Œä½¿ç”¨è€…æŒ‡å®šäº† workflowï¼šstandardã€
- éæ³• keyï¼ˆ`[workflow:nonexistent]`ï¼‰ï¼šéœé»˜é™ç´šï¼Œå›åˆ° `/ot:auto` æµç¨‹
- å¤§å°å¯«ä¸æ•æ„Ÿï¼ˆ`[Workflow:QUICK]`ï¼‰ï¼šæ­£ç¢ºè§£æç‚º `quick`
- **è¡Œç‚ºåå·®**ï¼š`/ot:standard` è¼¸å…¥æ™‚ï¼Œè¼¸å‡º `{"additionalContext":""}` è€Œéè¦æ ¼å®šç¾©çš„ `{}`ï¼ˆç©ºç‰©ä»¶ï¼‰

### F5 â€” Loop æ©Ÿåˆ¶

- workflow æœªå®Œæˆæ™‚ï¼ŒStop hook è¼¸å‡º `{"decision":"block","reason":"..."}` â€” æ­£ç¢ºé˜»æ“‹é€€å‡º
- `reason` å«æ­£ç¢ºçš„ loop è¨ˆæ•¸ã€é€²åº¦æ¢ã€ä¸‹ä¸€æ­¥å§”æ´¾æç¤º
- æ‰€æœ‰éšæ®µå®Œæˆæ™‚ï¼Œè¼¸å‡ºå®Œæˆæ‘˜è¦ï¼ˆ`ğŸ‰ å·¥ä½œæµå®Œæˆï¼`ï¼‰

### F6 â€” SubagentStop è¨˜éŒ„

- `agent/on-stop.js` ç¬¬ 160 è¡Œç¢ºèªå«ã€Œå§”æ´¾ planner è¦åŠƒä¸‹ä¸€æ‰¹å·¥ä½œã€æç¤º
- å«ã€Œå¯é¸ï¼šå§”æ´¾ grader agent è©•ä¼°æ­¤éšæ®µè¼¸å‡ºå“è³ªã€çš„å¯é¸ grader å§”æ´¾æç¤º

### F7 â€” UserPromptSubmit â†’ /ot:auto æ³¨å…¥

| æƒ…å¢ƒ | é æœŸ | å¯¦éš› | çµæœ |
|------|------|------|------|
| ç„¡ workflow prompt | additionalContext å« `/ot:auto` | å« `/ot:auto` | âœ… |
| æœ‰é€²è¡Œä¸­ workflow prompt | additionalContext å«ã€Œå·¥ä½œæµé€²è¡Œä¸­ã€ | å«ã€Œå·¥ä½œæµé€²è¡Œä¸­ï¼šquickã€ | âœ… |
| `/ot:` é–‹é ­ prompt | `{}` | `{"additionalContext":""}` | âŒ æ ¼å¼å·®ç•° |
| `[workflow:quick]` è¦†å¯« | additionalContext å«ã€Œä½¿ç”¨è€…æŒ‡å®šäº† workflowï¼šquickã€ | å®Œå…¨ç¬¦åˆ | âœ… |

### F8 â€” timeline.jsonl äº‹ä»¶è¨˜éŒ„

- `emit()` æ­£ç¢ºå¯«å…¥ JSONLï¼Œts/type/category æ¬„ä½å®Œæ•´
- `emit()` å‚³å…¥ç„¡æ•ˆ eventType æ­£ç¢ºæ‹‹å‡ºã€ŒæœªçŸ¥çš„ timeline äº‹ä»¶é¡å‹ã€éŒ¯èª¤
- `query()` çš„ type filterã€category filterã€limit filter å…¨éƒ¨æ­£ç¢º
- `query()` åœ¨æª”æ¡ˆä¸å­˜åœ¨æ™‚å›å‚³ `[]`ï¼ˆgraceful fallbackï¼‰
- `latest()` æœ‰äº‹ä»¶æ™‚å›å‚³æœ€å¾Œä¸€ç­†ï¼Œç„¡äº‹ä»¶æ™‚å›å‚³ `null`

### F9 â€” workflow.json CAS åŸå­æ›´æ–°

- 12 å€‹ unit test å…¨éƒ¨é€šé
- `writeState()` å¾Œç„¡æ®˜é¤˜ `.tmp` æª”
- `updateStateAtomic()` æ­£ç¢ºæ”¯æ´å¤šæ¬„ä½åˆä½µä¿®æ”¹

### /api/registry ç«¯é»

- å›å‚³ `stages`ï¼ˆ14 å€‹ï¼‰ã€`workflows`ï¼ˆ15 å€‹ï¼‰ã€`agents`ï¼ˆ14 å€‹ï¼‰ä¸‰å€‹æ¬„ä½ï¼Œç¬¦åˆè¦æ ¼

---

## é‚Šç•Œæ¢ä»¶æ¸¬è©¦çµæœ

| æ¸¬è©¦ | è¼¸å…¥ | çµæœ |
|------|------|------|
| ç©º prompt | `{"user_prompt":""}` | æ­£ç¢ºæ³¨å…¥ `/ot:auto`ï¼ˆtrim å¾Œç‚ºç©ºï¼Œé `/ot:` é–‹é ­ï¼‰|
| ç©º workflow key | `[workflow:]` | æ­£å‰‡ `/\[workflow:([a-z0-9_-]+)\]/i` è¦æ±‚è‡³å°‘ 1 å­—å…ƒï¼Œæ­£ç¢ºéœé»˜å¿½ç•¥ |
| å…¨å¤§å¯« key | `[workflow:STANDARD]` | æ­£ç¢ºè§£æç‚º `standard` |
| å¤šå€‹è¦†å¯«èªæ³• | `[workflow:standard]...[workflow:quick]` | å–ç¬¬ä¸€å€‹ matchï¼ˆstandardï¼‰ï¼Œè¡Œç‚ºä¸€è‡´ |
| /ot: å‰å¾Œæœ‰ç©ºç™½ | `"  /ot:standard  "` | trim å¾Œæ­£ç¢ºè§¸ç™¼ passthroughï¼ˆå›å‚³ `{"additionalContext":""}`) |
| é /ot: å‰ç¶´å¤§å¯« | `"OT:standard"` | ä¸è§¸ç™¼ passthroughï¼Œæ­£ç¢ºæ³¨å…¥ `/ot:auto` |

---

## å•é¡Œç´€éŒ„

### P1 â€” `/ot:` passthrough è¼¸å‡ºæ ¼å¼èˆ‡è¦æ ¼ä¸ç¬¦ï¼ˆä½å½±éŸ¿ï¼‰

**ä½ç½®**ï¼š`hooks/scripts/prompt/on-submit.js` ç¬¬ 25 è¡Œ

**é æœŸ**ï¼ˆBDD spec F3 ç¬¬ 132 è¡Œã€F7 ç¬¬ 351 è¡Œï¼‰ï¼š
```json
{}
```

**å¯¦éš›è¼¸å‡º**ï¼š
```json
{"additionalContext":""}
```

**åˆ†æ**ï¼šèªç¾©ä¸Šç­‰æ•ˆ â€” ç©ºå­—ä¸²çš„ `additionalContext` èˆ‡ç¼ºå°‘è©²æ¬„ä½ï¼Œå° Claude Code hook system çš„è¡Œç‚ºå½±éŸ¿ç›¸åŒï¼ˆä¸æ³¨å…¥ä»»ä½•é¡å¤– contextï¼‰ã€‚ä½†åš´æ ¼å°ç…§è¦æ ¼æ–‡ä»¶å±¬æ–¼æ ¼å¼ä¸ç¬¦ã€‚

**åš´é‡ç¨‹åº¦**ï¼šä½ã€‚ä¸å½±éŸ¿å¯¦éš›åŠŸèƒ½ï¼Œç©ºå­—ä¸²èˆ‡ç©ºç‰©ä»¶å° hook consumer çš„æ•ˆæœç›¸åŒã€‚

---

## å¾…æ‰‹å‹•ç¢ºèªé …ç›®

1. **F2 Model Grader**ï¼šéœ€è¦åœ¨çœŸå¯¦ Claude Code session ä¸­åŸ·è¡Œå®Œæ•´å·¥ä½œæµï¼Œç¢ºèª `timeline.jsonl` æœ‰ `grader:score` äº‹ä»¶ï¼Œä¸” JSON çµæ§‹å« `scores.clarity/completeness/actionability/overall` æ¬„ä½ã€‚
   
2. **F4 Dashboard å‹•ç•«**ï¼šCSS å®šç¾©å®Œæ•´ï¼ˆ7 å€‹ keyframesã€`prefers-reduced-motion` ä¿è­·ï¼‰ï¼Œéœ€ç€è¦½å™¨ç¢ºèªï¼š
   - æ´»èº stage çš„è„ˆè¡é‚Šæ¡†å‹•ç•«ï¼ˆ`stage-activate 2s infinite`ï¼‰
   - å®Œæˆ stage çš„ç¢ºèªé–ƒå…‰ï¼ˆ`stage-complete 0.6s forwards`ï¼‰
   - Agent card é€²å ´å‹•ç•«ï¼ˆ`agent-enter 0.3s`ï¼‰
   - Loading spinner æ—‹è½‰ï¼ˆ`spin 1s linear infinite`ï¼‰
   - macOS æ¸›å°‘å‹•æ…‹æ•ˆæœå¾Œæ‰€æœ‰å‹•ç•«åœæ­¢

3. **F1 History Tab å‰ç«¯**ï¼šéœ€ç€è¦½å™¨ç¢ºèª `http://localhost:7777/session/{sessionId}` çš„ History Tab é»æ“Šå¾Œæ­£ç¢ºæ¸²æŸ“ pass@k å¡ç‰‡ï¼Œç„¡ JavaScript éŒ¯èª¤ã€‚

---

## V1 æ•´é«”è©•ä¼°

### è‡ªå‹•åŒ–é©—è­‰ï¼š165 passï¼Œ0 fail

### åŠŸèƒ½é€šéç‡ï¼š6/9 å®Œå…¨é€šéï¼Œ2/9 éƒ¨åˆ†é€šéï¼ˆå« 1 å€‹æ ¼å¼å·®ç•°ï¼‰ï¼Œ1/9 å¾…æ‰‹å‹•ç¢ºèªï¼ˆF2ï¼‰

**çµè«–ï¼šV1 åŸºç¤æ¶æ§‹ç©©å›ºï¼Œå¯é€²å…¥ V2 é–‹ç™¼ã€‚**

ä¸»è¦ç†ç”±ï¼š
- æ‰€æœ‰æ ¸å¿ƒæ¶æ§‹ï¼ˆF5 Loopã€F6 SubagentStopã€F8 timelineã€F9 CASï¼‰å·²é€šéè‡ªå‹•åŒ–å’Œæ•´åˆæ¸¬è©¦
- F1 passAtK è¨ˆç®—å’Œ API ç«¯é»åŠŸèƒ½æ­£ç¢º
- F3/F7 çš„å”¯ä¸€å•é¡Œæ˜¯ `/ot:` passthrough çš„è¼¸å‡ºæ ¼å¼ï¼ˆ`{"additionalContext":""}` vs `{}`ï¼‰ï¼Œä¸å½±éŸ¿å¯¦éš›è¡Œç‚º
- F4 å‹•ç•« CSS å¯¦ç¾å®Œæ•´ï¼Œåƒ…ç¼ºè¦–è¦ºç¢ºèª
- F2 Grader éœ€è¦çœŸå¯¦åŸ·è¡Œç’°å¢ƒï¼Œæ¶æ§‹ï¼ˆagent promptã€timeline eventTypeï¼‰å·²å°±ä½

**å»ºè­°é€²å…¥ V2 å‰å…ˆç¢ºèª**ï¼šç€è¦½å™¨æ‰‹å‹•é©—è­‰ F1 History Tab å’Œ F4 å‹•ç•«ï¼Œç¢ºä¿ Dashboard å‰ç«¯ç„¡å•é¡Œã€‚
