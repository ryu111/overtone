# BDD Spec å®Œæ•´ç¯„ä¾‹

> ğŸ“‹ **ä½•æ™‚è®€å–**ï¼šé¦–æ¬¡æ’°å¯« BDD spec æˆ–éœ€è¦æ ¼å¼åƒè€ƒæ™‚ã€‚

## ç¯„ä¾‹ 1ï¼šCRUD Feature

```gherkin
Feature: æ–‡ç« ç®¡ç†
  èº«ç‚ºä¸€å€‹éƒ¨è½æ ¼ä½œè€…
  æˆ‘æƒ³è¦ç®¡ç†è‡ªå·±çš„æ–‡ç« 
  ä»¥ä¾¿ç™¼ä½ˆå’Œç¶­è­·å…§å®¹

  Background:
    Given ä½¿ç”¨è€…å·²ç™»å…¥ç‚ºã€Œä½œè€…ã€è§’è‰²
    And ç³»çµ±ä¸­æœ‰ä»¥ä¸‹æ–‡ç« ï¼š
      | title       | status    | author |
      | Hello World | published | Alice  |
      | Draft Post  | draft     | Alice  |

  @smoke @crud
  Scenario: å»ºç«‹æ–°æ–‡ç« 
    When ä½¿ç”¨è€…å»ºç«‹æ–‡ç« ï¼š
      | title        | content          | tags       |
      | My New Post  | This is content  | tech, blog |
    Then æ–‡ç« å»ºç«‹æˆåŠŸ
    And æ–‡ç« ç‹€æ…‹ç‚ºã€Œdraftã€
    And æ–‡ç« åŒ…å« 2 å€‹ tag

  @crud
  Scenario: æ›´æ–°æ–‡ç« æ¨™é¡Œ
    Given æ–‡ç« ã€ŒHello Worldã€å­˜åœ¨
    When ä½¿ç”¨è€…å°‡æ¨™é¡Œæ”¹ç‚ºã€ŒHello World 2.0ã€
    Then æ–‡ç« æ¨™é¡Œæ›´æ–°ç‚ºã€ŒHello World 2.0ã€
    And æ–‡ç« çš„ updatedAt æ™‚é–“æ›´æ–°

  @crud
  Scenario: åˆªé™¤è‰ç¨¿æ–‡ç« 
    Given æ–‡ç« ã€ŒDraft Postã€ç‹€æ…‹ç‚º draft
    When ä½¿ç”¨è€…åˆªé™¤è©²æ–‡ç« 
    Then æ–‡ç« å¾ç³»çµ±ä¸­ç§»é™¤
    And å›æ‡‰åŒ…å«åˆªé™¤ç¢ºèª

  @edge-case
  Scenario: å˜—è©¦å»ºç«‹æ¨™é¡Œé‡è¤‡çš„æ–‡ç« 
    Given æ–‡ç« ã€ŒHello Worldã€å·²å­˜åœ¨
    When ä½¿ç”¨è€…å»ºç«‹æ¨™é¡Œç‚ºã€ŒHello Worldã€çš„æ–‡ç« 
    Then ç³»çµ±å›å‚³ã€Œæ¨™é¡Œå·²å­˜åœ¨ã€éŒ¯èª¤
    And æ–‡ç« æœªè¢«å»ºç«‹

  @edge-case
  Scenario: å˜—è©¦åˆªé™¤å·²ç™¼ä½ˆçš„æ–‡ç« 
    Given æ–‡ç« ã€ŒHello Worldã€ç‹€æ…‹ç‚º published
    When ä½¿ç”¨è€…å˜—è©¦åˆªé™¤è©²æ–‡ç« 
    Then ç³»çµ±å›å‚³ã€Œå·²ç™¼ä½ˆæ–‡ç« ä¸å¯ç›´æ¥åˆªé™¤ã€
    And å»ºè­°ä½¿ç”¨è€…å…ˆæ”¹ç‚ºè‰ç¨¿ç‹€æ…‹

  @error
  Scenario: å»ºç«‹ç©ºæ¨™é¡Œæ–‡ç« 
    When ä½¿ç”¨è€…å»ºç«‹æ–‡ç« æ™‚æ¨™é¡Œç‚ºç©º
    Then ç³»çµ±å›å‚³é©—è­‰éŒ¯èª¤ã€Œæ¨™é¡Œä¸å¯ç‚ºç©ºã€
    And æ–‡ç« æœªè¢«å»ºç«‹
```

## ç¯„ä¾‹ 2ï¼šèªè­‰ Feature

```gherkin
Feature: ä½¿ç”¨è€…èªè­‰
  èº«ç‚ºä¸€å€‹ä½¿ç”¨è€…
  æˆ‘æƒ³è¦å®‰å…¨åœ°ç™»å…¥ç³»çµ±
  ä»¥ä¾¿å­˜å–å—ä¿è­·çš„è³‡æº

  @smoke @auth
  Scenario: ä½¿ç”¨æ­£ç¢ºå¸³å¯†ç™»å…¥
    Given ä½¿ç”¨è€… "alice@test.com" å·²è¨»å†Š
    And å¯†ç¢¼ç‚º "SecurePass123!"
    When ä½¿ç”¨è€…ä»¥è©²å¸³å¯†ç™»å…¥
    Then ç™»å…¥æˆåŠŸ
    And å›æ‡‰åŒ…å«æœ‰æ•ˆçš„ JWT token
    And token æœ‰æ•ˆæœŸç‚º 24 å°æ™‚

  @auth
  Scenario: å¯†ç¢¼éŒ¯èª¤
    Given ä½¿ç”¨è€… "alice@test.com" å·²è¨»å†Š
    When ä½¿ç”¨è€…ä»¥éŒ¯èª¤å¯†ç¢¼ "wrong" ç™»å…¥
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 401
    And éŒ¯èª¤è¨Šæ¯ç‚ºã€Œå¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ã€
    But ä¸æ­éœ²æ˜¯å¸³è™Ÿé‚„æ˜¯å¯†ç¢¼æœ‰èª¤

  @auth
  Scenario: å¸³è™Ÿä¸å­˜åœ¨
    When ä½¿ç”¨è€…ä»¥ "nonexist@test.com" ç™»å…¥
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 401
    And éŒ¯èª¤è¨Šæ¯ç‚ºã€Œå¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ã€

  @security @auth
  Scenario: æš´åŠ›ç ´è§£é˜²è­·
    Given ä½¿ç”¨è€… "alice@test.com" å·²è¨»å†Š
    When ä½¿ç”¨è€…é€£çºŒ 5 æ¬¡è¼¸å…¥éŒ¯èª¤å¯†ç¢¼
    Then å¸³è™Ÿæš«æ™‚é–å®š 15 åˆ†é˜
    And ç³»çµ±è¨˜éŒ„ç•°å¸¸ç™»å…¥äº‹ä»¶
    And å³ä½¿ç¬¬ 6 æ¬¡è¼¸å…¥æ­£ç¢ºå¯†ç¢¼ä¹Ÿè¢«æ‹’çµ•

  @security @auth
  Scenario: JWT token éæœŸ
    Given ä½¿ç”¨è€…æŒæœ‰ä¸€å€‹å·²éæœŸçš„ JWT token
    When ä½¿ç”¨è€…å˜—è©¦å­˜å–å—ä¿è­·çš„ API
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 401
    And éŒ¯èª¤è¨Šæ¯ç‚ºã€ŒToken å·²éæœŸã€

  @security @auth
  Scenario: SQL injection é˜²è­·
    When ä½¿ç”¨è€…ä»¥å¸³è™Ÿ "admin' OR '1'='1" ç™»å…¥
    And å¯†ç¢¼ç‚º "anything"
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 401
    And ç³»çµ±ä¸åŸ·è¡Œä»»ä½•ç•°å¸¸ SQL
    And ç³»çµ±è¨˜éŒ„å¯ç–‘ç™»å…¥å˜—è©¦

  @auth
  Scenario Outline: å¯†ç¢¼å¼·åº¦é©—è­‰
    When ä½¿ç”¨è€…ä»¥å¯†ç¢¼ "<password>" è¨»å†Š
    Then ç³»çµ±åˆ¤å®šå¯†ç¢¼å¼·åº¦ç‚º "<result>"

    Examples:
      | password       | result               |
      | abc            | æ‹’çµ•ï¼ˆå°‘æ–¼ 8 å­—å…ƒï¼‰   |
      | abcdefgh       | æ‹’çµ•ï¼ˆç¼ºå°‘å¤§å¯«å’Œæ•¸å­—ï¼‰|
      | Abcdefg1       | æ¥å—                 |
      | Abc!@#12345    | æ¥å—ï¼ˆå¼·å¯†ç¢¼ï¼‰        |
```

## ç¯„ä¾‹ 3ï¼šéŒ¯èª¤è™•ç† Feature

```gherkin
Feature: API éŒ¯èª¤è™•ç†
  èº«ç‚ºä¸€å€‹ API æ¶ˆè²»è€…
  æˆ‘æƒ³è¦åœ¨éŒ¯èª¤æ™‚æ”¶åˆ°æœ‰æ„ç¾©çš„éŒ¯èª¤è¨Šæ¯
  ä»¥ä¾¿å¿«é€Ÿè¨ºæ–·å’Œä¿®å¾©å•é¡Œ

  @smoke @error
  Scenario: 404 Not Found
    When ä½¿ç”¨è€…å­˜å–ä¸å­˜åœ¨çš„ endpoint "/api/nonexist"
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 404
    And å›æ‡‰æ ¼å¼ç‚º JSON
    And åŒ…å« error æ¬„ä½ã€ŒResource not foundã€

  @error
  Scenario: 422 é©—è­‰éŒ¯èª¤
    Given ä½¿ç”¨è€…å·²ç™»å…¥
    When ä½¿ç”¨è€…é€å‡ºç¼ºå°‘å¿…è¦æ¬„ä½çš„è«‹æ±‚ï¼š
      | field  | value |
      | title  |       |
      | body   | OK    |
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 422
    And å›æ‡‰åŒ…å«é©—è­‰éŒ¯èª¤æ¸…å–®
    And éŒ¯èª¤æ¸…å–®åŒ…å« "title ä¸å¯ç‚ºç©º"

  @error
  Scenario: 500 Internal Server Error
    Given è³‡æ–™åº«é€£ç·šä¸­æ–·
    When ä½¿ç”¨è€…å˜—è©¦å­˜å–ä»»ä½• API
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 500
    And éŒ¯èª¤è¨Šæ¯ç‚ºã€ŒInternal server errorã€
    But ä¸åŒ…å« stack trace æˆ–ç³»çµ±å…§éƒ¨è³‡è¨Š

  @edge-case @error
  Scenario: è«‹æ±‚ body è¶…éå¤§å°é™åˆ¶
    Given ä½¿ç”¨è€…å·²ç™»å…¥
    When ä½¿ç”¨è€…ä¸Šå‚³è¶…é 10MB çš„æª”æ¡ˆ
    Then å›æ‡‰ç‹€æ…‹ç¢¼ 413
    And éŒ¯èª¤è¨Šæ¯åŒ…å«æœ€å¤§å…è¨±å¤§å°

  @error
  Scenario: ä¸¦è¡Œå¯«å…¥è¡çª
    Given ä½¿ç”¨è€… A å’Œä½¿ç”¨è€… B åŒæ™‚ç·¨è¼¯åŒä¸€ç¯‡æ–‡ç« 
    When ä½¿ç”¨è€… A å…ˆå„²å­˜ä¿®æ”¹
    And ä½¿ç”¨è€… B éš¨å¾Œå„²å­˜ä¿®æ”¹
    Then ä½¿ç”¨è€… B æ”¶åˆ°ç‰ˆæœ¬è¡çªéŒ¯èª¤
    And ä½¿ç”¨è€… B çš„ä¿®æ”¹æœªè¢«è¦†å¯«
    And ç³»çµ±å»ºè­°ä½¿ç”¨è€… B é‡æ–°æ•´ç†å¾Œå†ä¿®æ”¹

  @edge-case @error
  Scenario: Rate limiting
    Given ä½¿ç”¨è€…å·²ç™»å…¥
    When ä½¿ç”¨è€…åœ¨ 1 ç§’å…§é€å‡º 100 å€‹è«‹æ±‚
    Then è¶…éé™åˆ¶çš„è«‹æ±‚å›æ‡‰ç‹€æ…‹ç¢¼ 429
    And å›æ‡‰åŒ…å« Retry-After header
    And é™åˆ¶è§£é™¤å¾Œè«‹æ±‚æ¢å¾©æ­£å¸¸
```
