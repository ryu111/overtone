# æ­»ç¢¼æ¸…ç†å·¥å…·æŒ‡å—

> ğŸ“‹ **ä½•æ™‚è®€å–**ï¼šåŸ·è¡Œæ­»ç¢¼æ¸…ç†æˆ–éœ€è¦é¸æ“‡å·¥å…·æ™‚ã€‚

## å·¥å…·é¸æ“‡æ±ºç­–

```
æœ‰ tsconfig.jsonï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ knipï¼ˆTypeScript å°ˆæ¡ˆé¦–é¸ï¼‰
â””â”€â”€ å¦ â†’ æœ‰ package.jsonï¼Ÿ
    â”œâ”€â”€ æ˜¯ â†’ depcheckï¼ˆç´” JS å°ˆæ¡ˆï¼‰
    â””â”€â”€ å¦ â†’ æ‰‹å‹•åˆ†æï¼ˆgrep + IDE referencesï¼‰
```

## knipï¼ˆæ¨è–¦ â€” TypeScript/JavaScriptï¼‰

### åŠŸèƒ½
- åµæ¸¬æœªä½¿ç”¨çš„ exportsã€filesã€dependenciesã€devDependencies
- æ”¯æ´ monorepoï¼ˆworkspacesï¼‰
- ç†è§£æ¡†æ¶ç‰¹å®šçš„é€²å…¥é»ï¼ˆNext.js pagesã€Jest config ç­‰ï¼‰

### ä½¿ç”¨æ–¹å¼
```bash
# å®‰è£ï¼ˆè‹¥æœªå®‰è£ï¼‰
npx knip

# åªçœ‹å ±å‘Šä¸åšæ”¹å‹•
npx knip --reporter compact

# æŒ‡å®šè¨­å®šæª”
npx knip --config knip.json
```

### åµæ¸¬é …ç›®
| é¡åˆ¥ | èªªæ˜ |
|------|------|
| Unused files | æ²’æœ‰è¢«ä»»ä½•æª”æ¡ˆ import çš„ .ts/.js æª”æ¡ˆ |
| Unused exports | æœ‰ export ä½†æ²’æœ‰å¤–éƒ¨ import |
| Unused dependencies | package.json ä¸­åˆ—å‡ºä½†æœªä½¿ç”¨çš„ä¾è³´ |
| Unlisted dependencies | ç¨‹å¼ç¢¼ä¸­ä½¿ç”¨ä½† package.json æœªåˆ—å‡ºçš„ä¾è³´ |

### æ¡†æ¶åµæ¸¬
knip è‡ªå‹•è­˜åˆ¥ä»¥ä¸‹æ¡†æ¶çš„é€²å…¥é»ï¼š

| æ¡†æ¶ | è­˜åˆ¥æ–¹å¼ | é€²å…¥é» |
|------|----------|--------|
| Next.js | `next.config.*` | `pages/`ã€`app/`ã€`middleware.ts` |
| Remix | `remix.config.*` | `app/routes/` |
| Vite | `vite.config.*` | `index.html`ã€`src/main.ts` |
| Jest | `jest.config.*` | `**/*.test.ts` |
| Vitest | `vitest.config.*` | `**/*.test.ts` |

## depcheckï¼ˆJavaScript å°ˆæ¡ˆï¼‰

### åŠŸèƒ½
- åµæ¸¬æœªä½¿ç”¨çš„ npm dependencies
- æ¯” knip ç°¡å–®ä½†ä¸åµæ¸¬æœªä½¿ç”¨çš„ exports

### ä½¿ç”¨æ–¹å¼
```bash
npx depcheck

# å¿½ç•¥ç‰¹å®šä¾è³´
npx depcheck --ignores="@types/*,eslint-*"
```

## å®‰å…¨åˆªé™¤ç­–ç•¥

### åˆªé™¤å‰ç¢ºèª

ğŸ“‹ MUST åœ¨åˆªé™¤å‰æ’é™¤ä»¥ä¸‹æƒ…æ³ï¼š

1. **å‹•æ…‹å¼•ç”¨**ï¼š`require(variable)`ã€`import(variable)` ç­‰å‹•æ…‹è¼‰å…¥
2. **æ¡†æ¶æ…£ä¾‹**ï¼šNext.js pagesã€API routesã€middleware ç­‰ä¾è³´æª”æ¡ˆç³»çµ±è·¯å¾‘
3. **CLI å·¥å…·**ï¼špackage.json `bin` æ¬„ä½æŒ‡å®šçš„å…¥å£
4. **è¨­å®šæª”å¼•ç”¨**ï¼šwebpack/rollup/vite è¨­å®šä¸­å¼•ç”¨çš„ plugin
5. **æ¸¬è©¦å·¥å…·**ï¼šJest/Vitest setup filesã€global fixtures
6. **Type-only imports**ï¼šåªåœ¨å‹åˆ¥ä¸­ä½¿ç”¨çš„ dependencyï¼ˆå¦‚ `@types/*`ï¼‰

### åˆªé™¤æ­¥é©Ÿ

1. **æ”¶é›†å ±å‘Š**ï¼šåŸ·è¡Œå·¥å…·å–å¾—æœªä½¿ç”¨é …ç›®æ¸…å–®
2. **äººå·¥ç¢ºèª**ï¼šæ’é™¤å‹•æ…‹å¼•ç”¨å’Œæ¡†æ¶æ…£ä¾‹
3. **é€ä¸€åˆªé™¤**ï¼šä¸€æ¬¡åˆªé™¤ä¸€å€‹é …ç›®ï¼ˆæˆ–ä¸€çµ„ç›¸é—œé …ç›®ï¼‰
4. **é©—è­‰**ï¼šæ¯æ¬¡åˆªé™¤å¾ŒåŸ·è¡Œ build + test
5. **å›æ»¾**ï¼šé©—è­‰å¤±æ•— â†’ ç«‹å³ `git checkout` å›æ»¾æœ€å¾Œä¸€æ¬¡åˆªé™¤

### é¢¨éšªç­‰ç´š

| é¢¨éšª | é …ç›® | è™•ç†æ–¹å¼ |
|:----:|------|----------|
| ä½ | æœªä½¿ç”¨çš„ devDependency | ç›´æ¥åˆªé™¤ |
| ä½ | æœªä½¿ç”¨çš„å·¥å…·å‹ exportï¼ˆinternal helperï¼‰ | ç›´æ¥åˆªé™¤ |
| ä¸­ | æœªä½¿ç”¨çš„ dependency | ç¢ºèªç„¡å‹•æ…‹å¼•ç”¨å¾Œåˆªé™¤ |
| ä¸­ | æœªä½¿ç”¨çš„æª”æ¡ˆ | ç¢ºèªéæ¡†æ¶é€²å…¥é»å¾Œåˆªé™¤ |
| é«˜ | æœªä½¿ç”¨ä½†æœ‰ side effect çš„ import | éœ€æ·±å…¥åˆ†æï¼ˆpolyfillã€CSS import ç­‰ï¼‰ |
| é«˜ | è¢« re-export çš„æ¨¡çµ„ | æª¢æŸ¥æ˜¯å¦ç‚ºå…¬é–‹ API çš„ä¸€éƒ¨åˆ† |

## æ¸…ç†å ±å‘Šæ ¼å¼

```markdown
## æ­»ç¢¼æ¸…ç†å ±å‘Š

### å·¥å…·
ä½¿ç”¨ [knip/depcheck] æƒæ

### å·²æ¸…ç†
- [åˆ—å‡ºå·²å®‰å…¨åˆªé™¤çš„é …ç›®]

### éœ€äººå·¥ç¢ºèª
- [åˆ—å‡ºç„¡æ³•è‡ªå‹•åˆ¤å®šçš„é …ç›® + åŸå› ]

### é©—è­‰çµæœ
- Build: âœ…/âŒ
- Tests: âœ…/âŒï¼ˆX passed, Y failedï¼‰
```
